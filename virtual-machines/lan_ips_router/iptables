# adapted from http://arstechnica.com/gadgets/2016/04/the-ars-guide-to-building-a-linux-router-from-scratch/

*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]

# eth2 is DMZ interface, #eth1 is LAN interface
-A POSTROUTING -o eth2 -j MASQUERADE

# NAT pinhole: HTTP from DMZ to LAN
-A PREROUTING -p tcp -m tcp -i eth2 --dport 22 -j DNAT --to-destination 10.0.0.6:22

COMMIT

*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

# Service rules
-A INPUT -j DROP

# Forwarding rules

# forward packets along established/related connections
-A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT

# forward from LAN (eth1) to DMZ (eth2)
-A FORWARD -i eth1 -o eth2 -j ACCEPT

# allow traffic from our NAT pinhole
-A FORWARD -p tcp -d 10.0.0.6 --dport 22 -j ACCEPT

# drop all other forwarded traffic
-A FORWARD -j DROP

COMMIT
